let kanjiList=[];const apiURL="https://kanjiapi.dev/v1/kanji/",answerButtons=document.querySelectorAll(".answer-btn"),answerOne=document.getElementById("answer-one"),answerTwo=document.getElementById("answer-two"),answerThree=document.getElementById("answer-three"),answerFour=document.getElementById("answer-four"),startButton=document.getElementById("start"),nextButton=document.getElementById("next"),kanjiInfoButton=document.getElementById("kanji-info"),exitButton=document.getElementById("exit"),startContainer=document.getElementById("start-container"),questionContainer=document.getElementById("question-container"),answerContainer=document.getElementById("answer-container"),counterSection=document.getElementById("counter"),spinner=document.getElementById("spinner"),startBtnTxt=document.getElementById("start-btn-txt"),gradeSwitches=document.querySelectorAll(".form-check-input");let counterRightAnswer=0,counterWrongAnswer=0;async function fetchKanjiInfo(a){return await await (await fetch(apiURL+a)).json()}function add(a){kanjiList.push(a)}const sleep=a=>new Promise(b=>setTimeout(b,a));let gradeURL;async function fetchKanji(){let a=document.getElementById("first-grade"),b=document.getElementById("second-grade"),c=document.getElementById("third-grade"),d=document.getElementById("fourth-grade"),e=document.getElementById("fifth-grade"),f=document.getElementById("sixth-grade");a.checked?gradeURL=`${apiURL}grade-1`:b.checked?gradeURL=`${apiURL}grade-2`:c.checked?gradeURL=`${apiURL}grade-3`:d.checked?gradeURL=`${apiURL}grade-4`:e.checked?gradeURL=`${apiURL}grade-5`:f.checked&&(gradeURL=`${apiURL}grade-6`);let g=await (await fetch(gradeURL)).json();for(let h of g)add(h)}function randomKanji(){return kanjiList[Math.floor(Math.random()*kanjiList.length)]}async function fetchMeaning(a){return(await (await fetch(`https://kanjiapi.dev/v1/kanji/${a}`)).json()).meanings[0]}async function randomMeaning(){let a=randomKanji();if(a!==rightKanji)return await fetchMeaning(a);a=randomKanji()}async function showWrongAnswers(){answerOne.innerText=await randomMeaning(),await sleep(50),answerTwo.innerText=await randomMeaning(),await sleep(50),answerThree.innerText=await randomMeaning(),await sleep(50),answerFour.innerText=await randomMeaning(),await sleep(50)}let rightKanji;async function populateRightKanji(){rightKanji=await (await fetch(`https://kanjiapi.dev/v1/kanji/${await randomKanji()}`)).json()}async function showQuestion(){switch(await populateRightKanji(),questionContainer.innerText=rightKanji.kanji,Math.floor(4*Math.random())){case 0:answerOne.innerText=rightKanji.meanings[0];break;case 1:answerTwo.innerText=rightKanji.meanings[0];break;case 2:answerThree.innerText=rightKanji.meanings[0];break;case 3:answerFour.innerText=rightKanji.meanings[0]}}function displayCounter(){let a=document.getElementById("right-answers"),b=document.getElementById("wrong-answers");a.innerHTML=counterRightAnswer,b.innerHTML=counterWrongAnswer}function rightAnswer(a){for(let b of answerButtons)b.classList.remove("btn-outline-primary"),b.classList.add("btn-danger"),b.classList.add("disabled");a.classList.remove("btn-danger"),a.classList.add("btn-success"),a.classList.add("disabled"),counterRightAnswer++,displayCounter(),keyOneFired=!0,keyTwoFired=!0,keyThreeFired=!0,keyFourFired=!0,kanjiInfoButton.disabled=!1}function wrongAnswer(a){a.classList.remove("btn-outline-primary"),a.classList.add("btn-danger"),a.classList.add("disabled"),counterWrongAnswer++,displayCounter()}function checkAnswer(a){a.innerText===rightKanji.meanings[0]?rightAnswer(a):wrongAnswer(a)}answerOne.addEventListener("click",a=>checkAnswer(a.target)),answerTwo.addEventListener("click",a=>checkAnswer(a.target)),answerThree.addEventListener("click",a=>checkAnswer(a.target)),answerFour.addEventListener("click",a=>checkAnswer(a.target));let keyOneFired=!1,keyTwoFired=!1,keyThreeFired=!1,keyFourFired=!1;async function start(){startButton.disabled=!0,spinner.classList.remove("invisible"),startBtnTxt.classList.add("invisible"),await fetchKanji(),await showWrongAnswers(),showQuestion(),questionContainer.classList.remove("hidden"),answerContainer.classList.remove("hidden"),nextButton.classList.remove("hidden"),kanjiInfoButton.classList.remove("hidden"),exitButton.classList.remove("hidden"),counterSection.classList.remove("hidden"),startContainer.classList.add("hidden"),counterRightAnswer=0,counterWrongAnswer=0}function cleanAnswerButtons(){for(let a of answerButtons)a.classList.remove("btn-danger"),a.classList.remove("btn-success"),a.classList.add("btn-outline-primary"),a.classList.remove("disabled")}function exit(){for(let a of(cleanAnswerButtons(),questionContainer.classList.add("hidden"),answerContainer.classList.add("hidden"),nextButton.classList.add("hidden"),kanjiInfoButton.classList.add("hidden"),kanjiInfoButton.disabled=!0,exitButton.classList.add("hidden"),counterSection.classList.add("hidden"),startContainer.classList.remove("hidden"),spinner.classList.remove("visible"),spinner.classList.add("invisible"),startBtnTxt.classList.remove("invisible"),gradeSwitches))a.checked=!1;kanjiList.length=0}function checkKanjiGrade(){for(let a of gradeSwitches)a.onchange=function(){startButton.disabled=!a.checked}}document.addEventListener("keypress",a=>{"1"!==a.key||keyOneFired?"2"!==a.key||keyTwoFired?"3"!==a.key||keyThreeFired?"4"!==a.key||keyFourFired||(keyFourFired=!0,checkAnswer(answerFour)):(keyThreeFired=!0,checkAnswer(answerThree)):(keyTwoFired=!0,checkAnswer(answerTwo)):(keyOneFired=!0,checkAnswer(answerOne))}),startButton.addEventListener("click",start),nextButton.addEventListener("click",async a=>{keyOneFired=!1,keyTwoFired=!1,keyThreeFired=!1,keyFourFired=!1,a.preventDefault(),cleanAnswerButtons(),await showWrongAnswers(),showQuestion(),kanjiInfoButton.disabled=!0}),kanjiInfoButton.addEventListener("click",g=>{let a=document.getElementById("kanji-info-modal-title"),b=document.getElementById("modal-meanings"),c=document.getElementById("modal-kun-reading"),d=document.getElementById("modal-on-reading"),e=document.getElementById("modal-strokes"),f=document.getElementById("modal-jlpt");a.innerText=rightKanji.kanji,b.innerText=rightKanji.meanings.join(", "),c.innerText=rightKanji.kun_readings.join(", "),d.innerText=rightKanji.on_readings.join(", "),e.innerText=rightKanji.stroke_count,f.innerText=rightKanji.jlpt}),exitButton.addEventListener("click",exit),checkKanjiGrade()