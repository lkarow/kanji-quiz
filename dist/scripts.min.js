let kanjiList=[];const apiURL="https://kanjiapi.dev/v1/kanji/",answerButtons=document.querySelectorAll(".answer-btn"),answerOne=document.getElementById("answer-one"),answerTwo=document.getElementById("answer-two"),answerThree=document.getElementById("answer-three"),answerFour=document.getElementById("answer-four"),startButton=document.getElementById("start"),nextButton=document.getElementById("next"),kanjiInfoButton=document.getElementById("kanji-info"),exitButton=document.getElementById("exit"),startContainer=document.getElementById("start-container"),questionContainer=document.getElementById("question-container"),answerContainer=document.getElementById("answer-container"),counterSection=document.getElementById("counter"),spinner=document.getElementById("spinner"),startBtnTxt=document.getElementById("start-btn-txt"),gradeSwitches=document.querySelectorAll(".form-check-input");let counterRightAnswer=0,counterWrongAnswer=0;async function fetchKanjiInfo(e){return await await (await fetch(apiURL+e)).json()}function add(e){kanjiList.push(e)}const sleep=e=>new Promise(n=>setTimeout(n,e));let gradeURL;async function fetchKanji(){let e=document.getElementById("first-grade"),n=document.getElementById("second-grade"),t=document.getElementById("third-grade"),i=document.getElementById("fourth-grade"),a=document.getElementById("fifth-grade"),r=document.getElementById("sixth-grade");e.checked?gradeURL=`${apiURL}grade-1`:n.checked?gradeURL=`${apiURL}grade-2`:t.checked?gradeURL=`${apiURL}grade-3`:i.checked?gradeURL=`${apiURL}grade-4`:a.checked?gradeURL=`${apiURL}grade-5`:r.checked&&(gradeURL=`${apiURL}grade-6`);let s=await (await fetch(gradeURL)).json();for(let d of s)add(d)}function randomKanji(){return kanjiList[Math.floor(Math.random()*kanjiList.length)]}async function fetchMeaning(e){return(await (await fetch(`https://kanjiapi.dev/v1/kanji/${e}`)).json()).meanings[0]}async function randomMeaning(){let e=randomKanji();if(e!==rightKanji)return await fetchMeaning(e);e=randomKanji()}async function showWrongAnswers(){let e=await randomMeaning();await sleep(50);let n=await randomMeaning();await sleep(50);let t=await randomMeaning();await sleep(50);let i=await randomMeaning();answerOne.innerText=e,answerTwo.innerText=n,answerThree.innerText=t,answerFour.innerText=i}let rightKanji;async function populateRightKanji(){rightKanji=await (await fetch(`https://kanjiapi.dev/v1/kanji/${await randomKanji()}`)).json()}async function showQuestion(){switch(await populateRightKanji(),questionContainer.innerText=rightKanji.kanji,Math.floor(4*Math.random())){case 0:answerOne.innerText=rightKanji.meanings[0];break;case 1:answerTwo.innerText=rightKanji.meanings[0];break;case 2:answerThree.innerText=rightKanji.meanings[0];break;case 3:answerFour.innerText=rightKanji.meanings[0]}}function displayCounter(){let e=document.getElementById("right-answers"),n=document.getElementById("wrong-answers");e.innerHTML=counterRightAnswer,n.innerHTML=counterWrongAnswer}function rightAnswer(e){for(let n of answerButtons)n.classList.remove("btn-outline-primary"),n.classList.add("btn-danger"),n.classList.add("disabled");e.classList.remove("btn-danger"),e.classList.add("btn-success"),e.classList.add("disabled"),counterRightAnswer++,displayCounter(),keyOneFired=!0,keyTwoFired=!0,keyThreeFired=!0,keyFourFired=!0,kanjiInfoButton.disabled=!1}function wrongAnswer(e){e.classList.remove("btn-outline-primary"),e.classList.add("btn-danger"),e.classList.add("disabled"),counterWrongAnswer++,displayCounter()}function checkAnswer(e){e.innerText===rightKanji.meanings[0]?rightAnswer(e):wrongAnswer(e)}answerOne.addEventListener("click",e=>checkAnswer(e.target)),answerTwo.addEventListener("click",e=>checkAnswer(e.target)),answerThree.addEventListener("click",e=>checkAnswer(e.target)),answerFour.addEventListener("click",e=>checkAnswer(e.target));let keyOneFired=!1,keyTwoFired=!1,keyThreeFired=!1,keyFourFired=!1;async function start(){startButton.disabled=!0,spinner.classList.remove("invisible"),startBtnTxt.classList.add("invisible"),await fetchKanji(),await showWrongAnswers(),showQuestion(),questionContainer.classList.remove("hidden"),answerContainer.classList.remove("hidden"),nextButton.classList.remove("hidden"),kanjiInfoButton.classList.remove("hidden"),exitButton.classList.remove("hidden"),counterSection.classList.remove("hidden"),startContainer.classList.add("hidden"),counterRightAnswer=0,counterWrongAnswer=0}function cleanAnswerButtons(){for(let e of answerButtons)e.classList.remove("btn-danger"),e.classList.remove("btn-success"),e.classList.add("btn-outline-primary"),e.classList.remove("disabled")}function exit(){for(let e of(cleanAnswerButtons(),questionContainer.classList.add("hidden"),answerContainer.classList.add("hidden"),nextButton.classList.add("hidden"),kanjiInfoButton.classList.add("hidden"),kanjiInfoButton.disabled=!0,exitButton.classList.add("hidden"),counterSection.classList.add("hidden"),startContainer.classList.remove("hidden"),spinner.classList.remove("visible"),spinner.classList.add("invisible"),startBtnTxt.classList.remove("invisible"),gradeSwitches))e.checked=!1;kanjiList.length=0}function checkKanjiGrade(){for(let e of gradeSwitches)e.onchange=function(){startButton.disabled=!e.checked}}document.addEventListener("keypress",e=>{"1"!==e.key||keyOneFired?"2"!==e.key||keyTwoFired?"3"!==e.key||keyThreeFired?"4"!==e.key||keyFourFired||(keyFourFired=!0,checkAnswer(answerFour)):(keyThreeFired=!0,checkAnswer(answerThree)):(keyTwoFired=!0,checkAnswer(answerTwo)):(keyOneFired=!0,checkAnswer(answerOne))}),startButton.addEventListener("click",start),nextButton.addEventListener("click",async e=>{keyOneFired=!1,keyTwoFired=!1,keyThreeFired=!1,keyFourFired=!1,e.preventDefault(),cleanAnswerButtons(),await showWrongAnswers(),showQuestion(),kanjiInfoButton.disabled=!0}),kanjiInfoButton.addEventListener("click",e=>{let n=document.getElementById("kanji-info-modal-title"),t=document.getElementById("modal-meanings"),i=document.getElementById("modal-kun-reading"),a=document.getElementById("modal-on-reading"),r=document.getElementById("modal-strokes"),s=document.getElementById("modal-jlpt");n.innerText=rightKanji.kanji,t.innerText=rightKanji.meanings.join(", "),i.innerText=rightKanji.kun_readings.join(", "),a.innerText=rightKanji.on_readings.join(", "),r.innerText=rightKanji.stroke_count,s.innerText=rightKanji.jlpt}),exitButton.addEventListener("click",exit),checkKanjiGrade();